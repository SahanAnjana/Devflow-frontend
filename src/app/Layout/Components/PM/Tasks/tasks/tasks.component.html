<div class="task-board-container">
  <!-- Header Section with Filters and Actions -->
  <div class="board-header">
    <div class="header-content">
      <h2 class="board-title">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
          <line x1="9" y1="9" x2="15" y2="9" />
          <line x1="9" y1="15" x2="15" y2="15" />
        </svg>
        Task Board
      </h2>

      <div class="filters-section">
        <div class="filter-group">
          <nz-select
            nzShowSearch
            nzPlaceHolder="Select Project"
            nzSuffixIcon="project"
            nzAllowClear="true"
            (ngModelChange)="getProjectId($event)"
            [(ngModel)]="projectId"
            class="filter-select project-filter"
          >
            <nz-option
              *ngFor="let project of allprojects"
              [nzValue]="project.id"
              [nzLabel]="project.name"
            ></nz-option>
          </nz-select>

          <nz-select
            nzShowSearch
            nzPlaceHolder="Filter by Status"
            nzSuffixIcon="filter"
            nzAllowClear="true"
            [(ngModel)]="status"
            (ngModelChange)="getStatus($event)"
            class="filter-select status-filter"
          >
            <nz-option nzLabel="In Progress" nzValue="in_Progress"
              >In Progress</nz-option
            >
            <nz-option nzLabel="In Review" nzValue="in_Review"
              >In Review</nz-option
            >
            <nz-option nzLabel="To Do" nzValue="to_Do">To Do</nz-option>
            <nz-option nzLabel="Done" nzValue="done">Done</nz-option>
          </nz-select>

          <nz-select
            nzShowSearch
            nzPlaceHolder="Filter by Assignee"
            nzSuffixIcon="user"
            nzAllowClear="true"
            class="filter-select assignee-filter"
          >
          </nz-select>
        </div>

        <div class="action-buttons">
          <button
            nz-button
            nzType="primary"
            class="new-task-btn"
            (click)="addNewTask('create')"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="12" y1="5" x2="12" y2="19" />
              <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            New Task
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Kanban Board -->
  <div class="kanban-board">
    <div
      class="kanban-column"
      *ngFor="let column of columns; let colIndex = index"
      cdkDropList
      [cdkDropListData]="column.tasks"
      [cdkDropListConnectedTo]="connectedDropListsIds"
      [id]="'cdk-drop-list-' + colIndex"
      (cdkDropListDropped)="drop($event)"
    >
      <!-- Column Header -->
      <div class="kanban-column-header">
        <div class="column-title">
          <div
            class="status-indicator"
            [class]="getStatusClass(column.status)"
          ></div>
          <span>{{ column.title }}</span>
        </div>
        <div class="task-count">{{ column.tasks.length || 0 }}</div>
      </div>

      <!-- Task Cards -->
      <div class="tasks-container">
        <div class="kanban-task-card" *ngFor="let task of column.tasks" cdkDrag>
          <div class="task-header">
            <h4 class="task-title">{{ task.title }}</h4>
            <div class="task-actions">
              <button
                nz-button
                nzType="text"
                nzSize="small"
                class="action-btn edit-btn"
                (click)="editTask(task, 'edit')"
                nz-tooltip="Edit Task"
              >
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                  />
                  <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                </svg>
              </button>
              <button
                nz-button
                nzType="text"
                nzSize="small"
                class="action-btn menu-btn"
                nz-dropdown
                [nzDropdownMenu]="menu"
                nzPlacement="bottomRight"
                nz-tooltip="More Actions"
              >
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="1" />
                  <circle cx="12" cy="5" r="1" />
                  <circle cx="12" cy="19" r="1" />
                </svg>
              </button>
              <nz-dropdown-menu #menu="nzDropdownMenu">
                <ul nz-menu>
                  <li nz-menu-item (click)="viewTask(task, 'view')">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                    View Task
                  </li>
                  <li
                    nz-menu-item
                    (click)="deleteTask(task)"
                    class="delete-item"
                  >
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="3,6 5,6 21,6" />
                      <path
                        d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"
                      />
                    </svg>
                    Delete Task
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>

          <div class="task-description" *ngIf="task['description']">
            {{ task["description"] }}
          </div>

          <div class="task-footer">
            <div class="task-meta">
              <div
                class="priority-badge"
                *ngIf="task['priority']"
                [class]="'priority-' + task['priority']"
              >
                {{ task["priority"] | titlecase }}
              </div>
              <div class="due-date" *ngIf="task['due_date']">
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                  <line x1="16" y1="2" x2="16" y2="6" />
                  <line x1="8" y1="2" x2="8" y2="6" />
                  <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                {{ task["due_date"] | date : "MMM dd" }}
              </div>
            </div>

            <div class="assignee-section">
              <nz-select
                nzShowSearch
                nzPlaceHolder="Assign"
                nzAllowClear="true"
                (ngModelChange)="changeAssignee($event, task)"
                [(ngModel)]="assigneeChange"
                class="assignee-select"
                nzSize="small"
              >
              </nz-select>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div
        class="empty-column"
        *ngIf="!column.tasks || column.tasks.length === 0"
      >
        <div class="empty-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
          >
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <line x1="12" y1="8" x2="12" y2="16" />
            <line x1="8" y1="12" x2="16" y2="12" />
          </svg>
        </div>
        <p>No tasks yet</p>
      </div>
    </div>
  </div>
</div>
